<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Python Code Challenge</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">

    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.5; }
        .CodeMirror { 
            border: 1px solid #ccc;
            height: 400px; 
            font-size: 14px;
        }
        #run-btn {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
        }
        #output {
            background-color: #f4f4f4;
            color: #333;
            padding: 15px;
            min-height: 50px;
            white-space: pre-wrap;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        /* ** NEW STYLES FOR PASS/FAIL ** */
        #output.pass {
            background-color: #e6ffed;
            color: #2d6a4f;
            border-color: #95d5b2;
        }
        #output.fail {
            background-color: #ffebe6;
            color: #9d2503;
            border-color: #ffb3a0;
        }
    </style>
</head>
<body>
    <h2>Python Code Challenge üß™</h2>
    <p>
        Your code must pass our tests. Define a function <strong>add(a, b)</strong> that correctly returns the sum of two numbers.
    </p>

    <textarea id="editor">
print("Hello world")
</textarea>
    
    <br>
    <button id="run-btn">Run Tests</button>
    
    <h3>Result:</h3>
    <pre id="output"></pre>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>

    <script>
        const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: 'python',
            theme: 'material-darker',
            lineNumbers: true,
            autoCloseBrackets: true,
        });

        document.getElementById('run-btn').addEventListener('click', async () => {
            const code = editor.getValue();
            const outputElement = document.getElementById('output');
            
            outputElement.textContent = 'Running tests in secure container...';

            outputElement.classList.remove('pass', 'fail');

            try {
                const response = await fetch('/CodeIslander/run-code-secure/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'An unknown error occurred.');
                }

                const resultText = data.output || data.error || 'No output produced.';
                outputElement.textContent = resultText;
                
 
                if (resultText.startsWith('‚úÖ')) {
                    outputElement.classList.add('pass');
                } else if (resultText.startsWith('‚ùå')) {
                    outputElement.classList.add('fail');
                }

            } catch (error) {
                outputElement.textContent = `Error: ${error.message}`;
                outputElement.classList.add('fail');
            }
        });
    </script>
</body>
</html>